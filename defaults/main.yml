---

# Directory to install source code
archivematica_src_dir: "/opt/archivematica"

# Shared directory for processing, etc
archivematica_src_shareddir: "/var/archivematica/sharedDirectory"

# Components to install
archivematica_src_install_am: "yes"
archivematica_src_install_ss: "yes"
archivematica_src_install_sample_data: "yes"
archivematica_src_install_devtools: "no"
archivematica_src_install_automationtools: "no"
archivematica_src_install_acceptance_tests: "no"
archivematica_src_install_fixity: "no"
archivematica_src_search_enabled: "yes"

# Define the type of environment: "production" or "development". The latter will deploy some extra stuff to make the development workflow easier.
archivematica_src_environment_type: "production"

# Repositories
archivematica_src_am_repo: "https://github.com/artefactual/archivematica.git"
archivematica_src_ss_repo: "https://github.com/artefactual/archivematica-storage-service.git"
archivematica_src_automation_tools_repo: "https://github.com/artefactual/automation-tools.git"

# Branches
archivematica_src_am_version: "qa/1.x"
archivematica_src_ss_version: "qa/0.x"
archivematica_src_devtools_version: "master"
archivematica_src_automationtools_version: "master"
archivematica_src_acceptance_tests_version: "master"

# Reset data options
archivematica_src_reset_mcpdb: "false"           # Reset AM MCP database
archivematica_src_reset_shareddir: "false"       # Reset AM shared directory
archivematica_src_reset_es: "false"              # Reset AM Elasticsearch indices
archivematica_src_reset_am_all: "false"          # Reset AM Elasticsearch indices, shared directory, MCP database (overrides previous settings)
archivematica_src_reset_ss_db: "false"           # Reset the SS database

# Database options
archivematica_src_am_migrate_from_v1_4: "false"  # Migrate AM database from v1.4 to v1.5
archivematica_src_ss_migrate_from_v0_7: "false"  # Migrate AM database from v1.4 to v1.5
archivematica_src_am_create_db: "true"           # Create database (uses root's credentials in ~/.my.cnf)
archivematica_src_am_create_dbuser: "true"       # Create user database (uses root's credentials in ~/.my.cnf)
archivematica_src_am_wait_local_mysql: "true"    # MCPServer upstart service to wait until MySQL is locally available
archivematica_src_am_db_host: "localhost"        # Archivematica database host
archivematica_src_am_db_name: "MCP"              # Archivematica database name
archivematica_src_am_db_user: "archivematica"    # Archivematica database user
archivematica_src_am_db_password: "demo"         # Archivematica database password
archivematica_src_am_es_server: "127.0.0.1:9200" # Archivematica ElasticSearch server

# Please note that a playbook using `archivematica_src_am_migrate_from_v1_4` or `archivematica_src_ss_migrate_from_v0_7`  is not idempotent, and it will throw an error if run twice. The two migrate related variables should be removed after a successful migration (an alternative could be to specify the `archivematica_src_am_migrate_from_v1_4` and `archivematica_src_ss_migrate_from_v0_7` at run time using `--extra-vars` instead of putting the variables in the playbook).


#
# Environment strings
#

# archivematica_src_ca_custom_bundle can be defined as var. If not defined it will be autogenerated by the playbook and AM will use the OS CA bundle. On Ubuntu, the system ca bundle /etc/ssl/certs/ca-certificates.crt file will be used. The /etc/pki/tls/certs/ca-bundle.crt file is the system ca bundle on CentOS. For more info, refer to the CA certificates at Security section in the Archivematica Documentation. Original am-packbuild issue: https://github.com/artefactual-labs/am-packbuild/issues/107

# Archivematica Dashboard
# This list only includes mandatory strings.
archivematica_src_am_dashboard_environment:
  DJANGO_SETTINGS_MODULE: "settings.production"
  ARCHIVEMATICA_DASHBOARD_DASHBOARD_DJANGO_ALLOWED_HOSTS: "*"
  ARCHIVEMATICA_DASHBOARD_DASHBOARD_DJANGO_SECRET_KEY: "CHANGE_ME_WITH_A_SECRET_KEY"
  ARCHIVEMATICA_DASHBOARD_DASHBOARD_SEARCH_ENABLED: "{{ archivematica_src_search_enabled }}"
  ARCHIVEMATICA_DASHBOARD_CLIENT_HOST: "{{ archivematica_src_am_db_host }}"
  ARCHIVEMATICA_DASHBOARD_CLIENT_DATABASE: "{{ archivematica_src_am_db_name }}"
  ARCHIVEMATICA_DASHBOARD_CLIENT_USER: "{{ archivematica_src_am_db_user }}"
  ARCHIVEMATICA_DASHBOARD_CLIENT_PASSWORD: "{{ archivematica_src_am_db_password }}"
  # Not mandatory:
  ARCHIVEMATICA_DASHBOARD_DASHBOARD_ELASTICSEARCH_SERVER: "{{ archivematica_src_am_es_server }}"  # Needed by pipeline-es.yml
  AM_GUNICORN_BIND: "127.0.0.1:8002"
  REQUEST_CA_BUNDLE: "{{ archivematica_src_ca_custom_bundle }}"

# Archivematica MCPServer
# This list only includes mandatory strings.
archivematica_src_am_mcpserver_environment:
  DJANGO_SETTINGS_MODULE: "settings.common"
  ARCHIVEMATICA_MCPSERVER_CLIENT_HOST: "{{ archivematica_src_am_db_host }}"
  ARCHIVEMATICA_MCPSERVER_CLIENT_DATABASE: "{{ archivematica_src_am_db_name }}"
  ARCHIVEMATICA_MCPSERVER_CLIENT_USER: "{{ archivematica_src_am_db_user }}"
  ARCHIVEMATICA_MCPSERVER_CLIENT_PASSWORD: "{{ archivematica_src_am_db_password }}"
  ARCHIVEMATICA_MCPSERVER_MCPSERVER_SEARCH_ENABLED: "{{ archivematica_src_search_enabled }}"

# Archivematica MCPClient
# This list only includes mandatory strings.
archivematica_src_am_mcpclient_environment:
  DJANGO_SETTINGS_MODULE: "settings.common"
  ARCHIVEMATICA_MCPCLIENT_CLIENT_HOST: "{{ archivematica_src_am_db_host }}"
  ARCHIVEMATICA_MCPCLIENT_CLIENT_DATABASE: "{{ archivematica_src_am_db_name }}"
  ARCHIVEMATICA_MCPCLIENT_CLIENT_USER: "{{ archivematica_src_am_db_user }}"
  ARCHIVEMATICA_MCPCLIENT_CLIENT_PASSWORD: "{{ archivematica_src_am_db_password }}"
  ARCHIVEMATICA_MCPCLIENT_MCPCLIENT_SEARCH_ENABLED: "{{ archivematica_src_search_enabled }}"
  REQUEST_CA_BUNDLE: "{{ archivematica_src_ca_custom_bundle }}"

# Archivematica Storage Service
# This list only includes mandatory strings.
archivematica_src_ss_environment:
  DJANGO_SETTINGS_MODULE: "storage_service.settings.production"
  DJANGO_ALLOWED_HOSTS: "*"
  DJANGO_SECRET_KEY: "CHANGE_ME_WITH_A_SECRET_KEY"
  SS_DB_HOST: ""
  SS_DB_NAME: "/var/archivematica/storage-service/storage.db"  # Needed by ss-db.yml
  SS_DB_PASSWORD: ""
  SS_DB_USER: ""
  # Not mandatory:
  SS_GUNICORN_BIND: "127.0.0.1:8001"
  REQUEST_CA_BUNDLE: "{{ archivematica_src_ca_custom_bundle }}"

#
# Clamav settings
#

# The following variables can be used to disable the Clamav daemon socket check and force the TCP socket configuration. When the Clamav daemon is not running on the same server than the pipeline, these variables have to be set to configure the Clamav daemon in the MCPClient

archivematica_src_mcpclient_clamav_use_tcp: "no"
archivematica_src_mcpclient_clamav_tcp_ip: "localhost"
archivematica_src_mcpclient_clamav_tcp_port: "3310"

#
# Logging settings
#

archivematica_src_logging_backward_compatible: "yes"
archivematica_src_dashboard_logdir: "/var/log/archivematica/dashboard"
archivematica_src_mcpclient_logdir: "/var/log/archivematica/MCPClient"
archivematica_src_mcpserver_logdir: "/var/log/archivematica/MCPServer"
archivematica_src_ss_logdir: "/var/log/archivematica/storage-service"
archivematica_src_dashboard_log_debug_maxbytes: "104857600"   # 100 MBytes
archivematica_src_mcpclient_log_debug_maxbytes: "4194304"     #   4 Mbytes
archivematica_src_mcpserver_log_debug_maxbytes: "4194304"     #   4 Mbytes
archivematica_src_ss_log_debug_maxbytes: "104857600"          # 100 MBytes
archivematica_src_dashboard_log_maxbytes: "20971520"          #  20 Mbytes
archivematica_src_mcpclient_log_maxbytes: "4194304"           #   4 Mbytes
archivematica_src_mcpserver_log_maxbytes: "4194304"           #   4 Mbytes
archivematica_src_ss_log_maxbytes: "20971520"                 #  20 Mbytes


#
# Nginx
#

# Use of UNIX sockets breaks AM API whitelisting that relis on REMOTE_ADDR. Using TCP sockets instead. See https://github.com/benoitc/gunicorn/issues/797 for more details.

archivematica_src_am_dashboard_nginx_bind: "127.0.0.1:8002"
archivematica_src_am_dashboard_nginx_proxy_read_timeout: "172800s"
archivematica_src_ss_nginx_bind: "127.0.0.1:8001"
archivematica_src_ss_nginx_proxy_read_timeout: "172800s"

# SSL settings
archivematica_src_ssl: "false"
# Include acmetool challenge location in dashboard nginx configuration (see https://github.com/artefactual-labs/ansible-acmetool for more details).
archivematica_src_ssl_include_acme_chlg_loc: "false"
# The following vars need to be defined in the playbook or host_vars:
# archivematica_src_ssl_fullchain: "/var/lib/acme/live/mysite.org/fullchain"
# archivematica_src_ssl_privkey: "/var/lib/acme/live/mysite.org/privkey"


#
# Other components
#

# Automation tools
archivematica_src_automationtools_transfers_logfile: "/var/log/archivematica/automation-tools/transfers.log"
archivematica_src_automationtools_transfers_databasefile: "/var/archivematica/automation-tools/transfers.db"
archivematica_src_automationtools_transfers_pidfile: "/var/archivematica/automation-tools/transfers-pid.lck"

# Acceptance tests
archivematica_src_acceptance_tests_browser_list: [ "Chrome" , "Firefox" ]
archivematica_src_acceptance_tests_chromedriver_version: "2.29"

# Fixity
archivematica_src_fixity_version: "master"
archivematica_src_fixity_ss_url: "http://localhost:8000"
archivematica_src_fixity_ss_user: "test"
archivematica_src_fixity_ss_apikey: "XXXX"

