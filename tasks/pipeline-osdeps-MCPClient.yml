---
# ubuntu block
- block:
    - name: "Install MCPClient ext. deps. repo keys"
      apt_key:
        id: "{{ item.id }}"
        url: "{{ item.url }}"
        state: "present"
        validate_certs: "{{ item.validate_certs }}"
      with_items: "{{ MCPClient.osdeps_repokeys }}"
      when:
        - "MCPClient.osdeps_repokeys"

    - name: "Add MCPClient ext. deps. repos"
      apt_repository:
        repo: "{{ item }}"
        state: "present"
      with_items: "{{ MCPClient.osdeps_repos }}"
      when:
        - "MCPClient.osdeps_repos"

    - name: "Install MCPClient ext. package deps."
      apt:
        pkg: "{{ MCPClient.osdeps_packages | json_query('[].name') }}"
        state: "latest"
      when:
        - "MCPClient.osdeps_packages"

  when:
    - ansible_distribution == "Ubuntu"

# Centos/RH block
- block:
    - name: "Add MCPClient ext. deps. repos (RH/CentOS)"
      yum_repository:
        name: "{{ item['name'] }}"
        description: "{{ item['description'] }}"
        baseurl: "{{ item['baseurl'] }}"
        gpgcheck: "{{ item['gpgcheck'] }}"
        enabled: "{{ item['enabled'] }}"
      with_items: "{{ MCPClient.osdeps_repos }}"
      when:
        - MCPClient.osdeps_repos

    - name: "Install MCPClient ext. package deps. (RH/CentOS)"
      yum:
        name: "{{ MCPClient.osdeps_packages | json_query('[].name') }}"
        state: "latest"
      when:
        - MCPClient.osdeps_packages is defined and MCPClient.osdeps_packages

    - name: "Install MCPClient ext. package deps. (2) (RH/CentOS)"
      yum:
        name: "{{ MCPClient.osdeps_packages_2 | json_query('[].name') }}"
        state: "latest"
      when:
        - MCPClient.osdeps_packages_2 is defined and MCPClient.osdeps_packages_2

    - name: "Install MCPClient ext. package deps. (3) (RH/CentOS)"
      yum:
        name: "{{ MCPClient.osdeps_packages_3 | json_query('[].name') }}"
        state: "latest"
      when:
        - MCPClient.osdeps_packages_3 is defined and MCPClient.osdeps_packages_3

  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
