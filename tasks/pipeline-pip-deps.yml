---
# this task is needed to avoid problems when upgrading python package
- name: "Remove old virtualenv default dirs"
  file:
    state: absent
    path: "/usr/share/python/{{ item }}/"
  with_items:
    - "archivematica-dashboard"
    - "archivematica-mcp-client"
    - "archivematica-mcp-server"

- name: "Create virtualenv and install pip-tools"
  pip:
    virtualenv: "{{ archivematica_src_am_virtualenv }}"
    virtualenv_command: "{{ archivematica_src_virtualenv }}"
    virtualenv_python: "{{ archivematica_src_virtualenv_python }}"
    name: "pip-tools=={{ archivematica_src_pip_tools_version }}"

- name: "Synchronize requirements"
  command: "{{ archivematica_src_am_virtualenv }}/bin/pip-sync {{ 'requirements-dev-py3.txt' if is_dev else 'requirements-py3.txt' }}"
  args:
    chdir: "{{ archivematica_src_dir }}/archivematica"
  environment:
    LC_ALL: "en_US.utf8"
    LANG: "en_US.utf8"
